<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>混合ダブルス乱数表（人数入力のみ・同ペア完全禁止）</title>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      margin:0; background:#f6f7f9;
    }
    header {
      background:#111827; color:#fff; padding:14px;
    }
    header h1 { margin:0; font-size:18px; }

    main { max-width:900px; margin:auto; padding:16px; }
    .card {
      background:#fff; border-radius:12px;
      padding:14px; margin-bottom:12px;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .field { flex:1 1 180px; }
    label { font-size:12px; color:#374151; display:block; margin-bottom:6px; }
    input, select, button {
      width:100%; padding:10px;
      border-radius:10px; border:1px solid #d1d5db;
      font:inherit;
    }
    button.primary {
      background:#111827; color:#fff; border:none; cursor:pointer;
    }
    button.ghost { cursor:pointer; }

    .round {
      border:1px solid #e5e7eb; border-radius:10px;
      padding:10px; margin:10px 0;
    }
    .round-title { font-weight:700; margin-bottom:6px; }

    .warn { color:#b91c1c; font-size:13px; }

    @media print {
      header, .controls { display:none; }
      main { max-width:none; padding:0; }
      .card { box-shadow:none; border-radius:0; }
      .round { break-inside: avoid; }
      .pagebreak { page-break-after: always; }
    }
  </style>
</head>

<body>
<header>
  <h1>混合ダブルス乱数表（人数入力のみ）</h1>
</header>

<main>
  <div class="card controls">
    <div class="row">
      <div class="field">
        <label>コート数</label>
        <input type="number" id="courts" value="3" min="1">
      </div>
      <div class="field">
        <label>ラウンド数</label>
        <input type="number" id="rounds" value="10" min="1">
      </div>
      <div class="field">
        <label>男子人数</label>
        <input type="number" id="menCount" value="10" min="0">
      </div>
      <div class="field">
        <label>女子人数</label>
        <input type="number" id="womenCount" value="10" min="0">
      </div>
      <div class="field">
        <label>同ペアルール</label>
        <select id="rule">
          <option value="soft">なるべく避ける</option>
          <option value="strict">完全禁止</option>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:12px;">
      <button class="primary" onclick="generate()">生成</button>
      <button class="ghost" onclick="window.print()">印刷</button>
    </div>

    <div id="status" class="warn" style="margin-top:8px;"></div>
  </div>

  <div class="card">
    <div id="output"></div>
  </div>
</main>

<script>
function makeList(prefix, n){
  return Array.from({length:n}, (_,i)=>prefix+(i+1));
}
function shuffle(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function courtName(i){ return String.fromCharCode(65+i); }
function key(m,w){ return m+"||"+w; }

function generate(){
  const courts = Number(courtsEl.value);
  const rounds = Number(roundsEl.value);
  const men = makeList("M", Number(menCount.value));
  const women = makeList("F", Number(womenCount.value));
  const rule = ruleEl.value;

  const needPairs = courts*2;
  const used = new Set();
  let failed = 0;

  output.innerHTML="";
  status.textContent="";

  for(let r=0;r<rounds;r++){
    let pairs = [];
    let attempts = 0;

    while(pairs.length===0 && attempts<50){
      attempts++;
      const M = shuffle(men.slice());
      const W = shuffle(women.slice());
      const usedW = new Set();
      const tmp = [];

      for(let i=0;i<Math.min(needPairs,M.length,W.length);i++){
        const m=M[i];
        const cand=W.filter(w=>!usedW.has(w) && (!used.has(key(m,w)) || rule==="soft"));
        if(cand.length===0) break;
        const w=cand[Math.floor(Math.random()*cand.length)];
        usedW.add(w);
        tmp.push([m,w]);
      }
      if(tmp.length===Math.min(needPairs,M.length,W.length)) pairs=tmp;
    }

    if(pairs.length===0){
      failed++;
      pairs = [];
    }

    if(rule==="strict"){
      pairs.forEach(p=>used.add(key(p[0],p[1])));
    }

    const ps = shuffle(pairs.map(p=>p[0]+"."+p[1]));
    const div=document.createElement("div");
    div.className="round";
    if((r+1)%10===0) div.classList.add("pagebreak");

    div.innerHTML=`<div class="round-title">第${r+1}ラウンド</div>`;
    for(let c=0;c<courts;c++){
      div.innerHTML+=`<div><b>${courtName(c)}コート</b>： ${ps[c*2]||"休"} vs ${ps[c*2+1]||"休"}</div>`;
    }
    output.appendChild(div);
  }

  if(rule==="strict" && failed>0){
    status.textContent=`⚠ 同ペア完全禁止が成立しないラウンドが ${failed} 回ありました`;
  }
}

const courtsEl = document.getElementById("courts");
const roundsEl = document.getElementById("rounds");
const menCount = document.getElementById("menCount");
const womenCount = document.getElementById("womenCount");
const ruleEl = document.getElementById("rule");
const output = document.getElementById("output");
const status = document.getElementById("status");
</script>
</body>
</html>
