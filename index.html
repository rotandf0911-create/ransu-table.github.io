<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>シングル・ダブルス乱数表（テニス・バド）</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#111827">

<style>
/* =====================
   ベース
===================== */
body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#f6f7f9}
header{background:#111827;color:#fff;padding:14px}
header h1{margin:0;font-size:18px}
main{max-width:1100px;margin:auto;padding:16px}

.card{background:#fff;border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,.08)}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end}
.field{flex:1 1 160px}
label{font-size:12px;color:#374151;display:block;margin-bottom:6px}
input,select,button{width:100%;padding:10px;border-radius:10px;border:1px solid #d1d5db;font:inherit}
button.primary{background:#111827;color:#fff;border:none;cursor:pointer}

.round{border:1px solid #e5e7eb;border-radius:12px;padding:12px;margin:12px 0}
.round-title{font-weight:900;margin-bottom:10px}

table{width:100%;border-collapse:collapse}
th,td{border-top:1px solid #e5e7eb;padding:12px;vertical-align:middle}
th{width:120px;font-weight:800;white-space:nowrap}

/* =====================
   試合表示（改行禁止）
===================== */
.match{
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:nowrap;            /* ★改行しない */
  white-space:nowrap;
  transform-origin:left center;
}
.pair{display:flex;gap:8px;flex-wrap:nowrap}

.box-male,.box-female{
  display:inline-flex;align-items:center;justify-content:center;
  min-width:48px;padding:10px 14px;
  border:3px solid #000;border-radius:12px;
  font-size:26px;font-weight:900
}
.box-male{color:#2563eb}
.box-female{color:#dc2626}
.box-rest{
  min-width:48px;padding:10px 14px;
  border:3px dashed #9ca3af;border-radius:12px;
  font-weight:900;color:#6b7280
}
.vs{font-weight:900;font-size:18px;white-space:nowrap}

/* =====================
   5R以上は横並び
===================== */
#output.gridRounds{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(340px,1fr));
  gap:12px;
}
#output.gridRounds .round{margin:0}

/* =====================
   モニター表示
===================== */
.monitor-overlay{
  position:fixed;inset:0;background:#0b1220;color:#fff;
  display:none;z-index:9999
}
.monitor-overlay.show{display:block}
.monitor-top{
  display:flex;justify-content:space-between;align-items:center;
  padding:10px;border-bottom:1px solid rgba(255,255,255,.2)
}
.monitor-btns{display:flex;gap:8px;align-items:center}
.monitor-btns button,.monitor-btns select{
  width:auto;padding:8px 12px;border-radius:10px;
  background:rgba(255,255,255,.1);color:#fff;
  border:1px solid rgba(255,255,255,.3)
}
.monitor-btns button.primary{background:#fff;color:#111;border:none}

.monitor-main{
  height:calc(100vh - 52px);
  display:flex;align-items:center;justify-content:center;
  overflow:hidden
}
#monitorStage{width:100%;height:100%;display:flex;align-items:center;justify-content:center}
#monitorScale{transform-origin:center center}

/* モニター用：縦ラウンド＋1行固定 */
.monitor-pack{display:flex;flex-direction:column;gap:14px}
.monitor-round{background:#fff;color:#111;border-radius:12px;padding:14px}
.monitor-round-title{font-size:28px;font-weight:900;margin-bottom:10px}
.monitor-line{
  display:grid;
  grid-template-columns:max-content 1fr;
  gap:14px;
  margin:10px 0
}
.monitor-court{font-size:22px;font-weight:900;white-space:nowrap}
.monitor-match{
  display:grid;
  grid-template-columns:max-content max-content max-content;
  gap:14px;
  white-space:nowrap
}
.monitor-round .box-male,
.monitor-round .box-female{
  font-size:34px;
  min-width:56px;
  padding:12px 16px
}

/* =====================
   印刷
===================== */
@media print{
  header,.controls,.monitor-overlay{display:none}
  .round{break-inside:avoid}
}
</style>
</head>

<body>
<header>
  <h1>シングル・ダブルス乱数表（テニス・バド）</h1>
</header>

<main>
<div class="card controls">
  <div class="row">
    <div class="field">
      <label>種目</label>
      <select id="gameType">
        <option value="doubles">ダブルス</option>
        <option value="singles">シングルス</option>
      </select>
    </div>
    <div class="field">
      <label>ラウンド数</label>
      <input type="number" id="rounds" value="10">
    </div>
    <div class="field">
      <label>コート数</label>
      <input type="number" id="courts" value="3">
    </div>
    <div class="field">
      <label>男</label>
      <input type="number" id="menCount" value="10">
    </div>
    <div class="field">
      <label>女</label>
      <input type="number" id="womenCount" value="10">
    </div>
  </div>

  <div class="row" style="margin-top:12px">
    <div class="field"><button class="primary" onclick="generate()">生成</button></div>
    <div class="field"><button onclick="openMonitor()">モニター表示</button></div>
    <div class="field"><button onclick="window.print()">印刷</button></div>
  </div>
</div>

<div class="card">
  <div id="output"></div>
</div>
</main>

<!-- モニター -->
<div id="monitor" class="monitor-overlay">
  <div class="monitor-top">
    <div id="monitorTitle">モニター</div>
    <div class="monitor-btns">
      <button onclick="prevRound()">←</button>
      <button class="primary" onclick="nextRound()">次へ</button>
      <select id="monitorView" onchange="setMonitorView(this.value)">
        <option value="1">1R</option>
        <option value="2">2R</option>
      </select>
      <button onclick="toggleFullscreen()">全画面</button>
      <button onclick="closeMonitor()">閉じる</button>
    </div>
  </div>
  <div class="monitor-main">
    <div id="monitorStage">
      <div id="monitorScale"></div>
    </div>
  </div>
</div>

<script>
/* ========= 共通 ========= */
const boxMale=n=>`<span class="box-male">${n}</span>`;
const boxFemale=n=>`<span class="box-female">${n}</span>`;
const boxRest=()=>`<span class="box-rest">休</span>`;
const courtName=i=>String.fromCharCode(65+i);

let __roundHTML=[],__roundIndex=0,__pageSize=1;

/* ========= 自動縮小（通常表示） ========= */
function fitMatchesInRounds(){
  document.querySelectorAll("#output .round td .match").forEach(match=>{
    match.style.transform="scale(1)";
    const parent=match.parentElement;
    if(!parent) return;
    const maxW=parent.clientWidth;
    const w=match.scrollWidth;
    if(w<=maxW) return;
    let s=maxW/w;
    s=Math.max(0.75,Math.min(1,s));
    match.style.transform=`scale(${s})`;
  });
}

/* ========= 生成 ========= */
function generate(){
  const rounds=+roundsEl.value||1;
  const courts=+courtsEl.value||1;
  const men=[...Array(+menCount.value||0)].map((_,i)=>i+1);
  const women=[...Array(+womenCount.value||0)].map((_,i)=>i+1);

  output.innerHTML="";
  output.classList.toggle("gridRounds", rounds>=5);

  for(let r=0;r<rounds;r++){
    const div=document.createElement("div");
    div.className="round";
    div.innerHTML=`<div class="round-title">第${r+1}ラウンド</div>`;
    let html="<table><tbody>";
    for(let c=0;c<courts;c++){
      const m1=men[(r+c*2)%men.length];
      const f1=women[(r+c*2)%women.length];
      const m2=men[(r+c*2+1)%men.length];
      const f2=women[(r+c*2+1)%women.length];
      html+=`
      <tr>
        <th>${courtName(c)}コート</th>
        <td>
          <div class="match">
            <span class="pair">${boxMale(m1)}${boxFemale(f1)}</span>
            <span class="vs">vs</span>
            <span class="pair">${boxMale(m2)}${boxFemale(f2)}</span>
          </div>
        </td>
      </tr>`;
    }
    html+="</tbody></table>";
    div.innerHTML+=html;
    output.appendChild(div);
  }

  fitMatchesInRounds();
  cacheRounds();
}

/* ========= モニター ========= */
function cacheRounds(){
  __roundHTML=[...document.querySelectorAll(".round")].map(r=>r.outerHTML);
  __roundIndex=0;
}
function openMonitor(){
  if(!__roundHTML.length) generate();
  monitor.classList.add("show");
  setMonitorView(monitorView.value);
}
function closeMonitor(){
  monitor.classList.remove("show");
  if(document.fullscreenElement) document.exitFullscreen();
}
function showRound(i){
  if(__pageSize===2){
    const maxStart=Math.max(0,__roundHTML.length-2);
    __roundIndex=Math.max(0,Math.min(i,maxStart));
    monitorScale.innerHTML=
      `<div class="monitor-pack">${__roundHTML[__roundIndex]}${__roundHTML[__roundIndex+1]}</div>`;
  }else{
    __roundIndex=Math.max(0,Math.min(i,__roundHTML.length-1));
    monitorScale.innerHTML=__roundHTML[__roundIndex];
  }
  fitMonitor();
}
function nextRound(){ showRound(__roundIndex+1); }
function prevRound(){ showRound(__roundIndex-1); }
function setMonitorView(v){ __pageSize=+v; showRound(__roundIndex); }
function fitMonitor(){
  monitorScale.style.transform="scale(1)";
  requestAnimationFrame(()=>{
    const s=Math.min(
      monitorStage.clientWidth/monitorScale.scrollWidth,
      monitorStage.clientHeight/monitorScale.scrollHeight
    );
    monitorScale.style.transform=`scale(${Math.max(.5,Math.min(1.2,s))})`;
  });
}
function toggleFullscreen(){
  document.fullscreenElement?document.exitFullscreen():monitor.requestFullscreen();
}

/* ========= DOM ========= */
const roundsEl=rounds;
const courtsEl=courts;
const menCountEl=menCount;
const womenCountEl=womenCount;
</script>
</body>
</html>
